<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <script type="module" src="./data.js"></script>
    <title>Песочный бой</title>
  </head>
  <body>
    <header class="header-container">
      <div class="header-title" id="header-title"></div>
      <div class="navigation">
        <nav>
          <a href="index.html"
            ><img src="./assets/png/home.png" alt="На главную"
          /></a>
          <a href="hero.html">
            <img src="./assets/png/hero.png" alt=" Ваш персонаж"
          /></a>
          <a href="character.html">
            <img
              src="./assets/png/settings.png"
              alt=" Изменить настройки персонажа"
          /></a>
        </nav>
      </div>
    </header>
    <main class="main-container">
      <div class="character-container">
        <div>
          <button type="button" class="button-submit" id="fight">В бой!</button>
        </div>
        <div>
          <div class="block_fight" id="block_fight">
            <div class="character-card">
              <div class="character-name">
                <input
                  class="character-name-input"
                  type="text"
                  id="character-name"
                  readonly
                />
              </div>
              <div class="character-edit">
                <img class="character-image" src="" alt="character-image" />
              </div>
              <div>
                <progress
                  class="progress"
                  value="0"
                  max="150"
                  id="progress-character"
                ></progress>
              </div>
            </div>
            <div class="container-fight">
              <div class="fight_message">
                Выберите один вид атаки и два вида защиты
              </div>
              <div class="container-radio">
                <div class="radio-group" id="radio-group">
                  <label for="radio1">
                    Тыдыщ!
                    <input type="radio" name="option" id="radio1" value="1"
                  /></label>
                  <label for="radio2">
                    Кусь<input
                      type="radio"
                      name="option"
                      id="radio2"
                      value="2"
                    />
                  </label>
                  <label for="radio3">
                    Хрясь<input
                      type="radio"
                      name="option"
                      id="radio3"
                      value="3"
                  /></label>
                  <label for="radio4">
                    Тьфу<input type="radio" name="option" id="radio4" value="4"
                  /></label>
                  <label for="radio5">
                    Два Куся<input
                      type="radio"
                      name="option"
                      id="radio5"
                      value="5"
                  /></label>
                </div>
                <div class="checkbox-group" id="checkbox-group">
                  <label for="checkbox1"
                    ><input type="checkbox" id="checkbox1" value="1" />
                    Тыдыщ!</label
                  >
                  <label for="checkbox2"
                    ><input type="checkbox" id="checkbox2" value="2" />
                    Кусь</label
                  >
                  <label for="checkbox3"
                    ><input type="checkbox" id="checkbox3" value="3" />
                    Хрясь</label
                  >
                  <label for="checkbox4"
                    ><input type="checkbox" id="checkbox4" value="4" />
                    Тьфу</label
                  >
                  <label for="checkbox5"
                    ><input type="checkbox" id="checkbox5" value="5" /> Два
                    Куся</label
                  >
                </div>
              </div>
              <div>
                <button class="button-submit" id="button-attack">Удар!</button>
              </div>
            </div>

            <div class="character-card">
              <div class="character-name-enemy">
                <input
                  class="character-name-input"
                  type="text"
                  id="character-name-enemy"
                  readonly
                />
              </div>
              <div class="character-edit">
                <img
                  class="character-image-enemy"
                  src=""
                  alt="character-image-enemy"
                />
              </div>
              <div>
                <progress
                  class="progress"
                  value="0"
                  max="150"
                  id="progress-enemy"
                ></progress>
              </div>
            </div>
          </div>
          <div class="fight_description" id="fight_description">
            <input
              type="text"
              class="textCharacter"
              id="textCharacter"
              readonly
            />
            Здесь будет описание боя
          </div>
        </div>
      </div>
    </main>
    <script>
      const player_wins = [
        {
          name: "",
          id: 0,
          wins: 0,
          loses: 0,
        },
      ];
      const enemy_wins = [
        {
          name: "",
          wins: 0,
          loses: 0,
        },
      ];

      document.addEventListener("DOMContentLoaded", () => {
        const name = localStorage.getItem("Player/name");
        const nameEnemy = localStorage.getItem("Enemy/name");
        const characterName = document.getElementById("character-name");
        const characterNameEnemy = document.getElementById(
          "character-name-enemy"
        );
        const avatar = window.appData.avatar;
        const enemy_avatar = window.appData.enemy_avatar;
        const attack = window.appData.attack;

        // Ограничение выбираемых чеков
        const checkboxes = document.querySelectorAll(
          '.checkbox-group input[type="checkbox"]'
        );
        const maxSelection = 2;

        checkboxes.forEach((cb) => {
          cb.addEventListener("change", () => {
            const checkedCount = [...checkboxes].filter(
              (c) => c.checked
            ).length;
            if (checkedCount > maxSelection) {
              cb.checked = false;
              alert(`Выберите только ${maxSelection} пункта`);
            }
          });
        });

        document.getElementById("fight").addEventListener("click", function () {
          this.style.display = "none";
          document.getElementById("block_fight").style.display = "flex";
          document.getElementById("fight_description").style.display = "flex";
        });

        if (name) {
          document.getElementById("character-name").value = name;
        }

        if (nameEnemy) {
          document.getElementById("character-name-enemy").value = nameEnemy;
        }

        let avatarData;
        const storedAvatar = localStorage.getItem("Player/avatar");
        if (storedAvatar && storedAvatar !== "undefined") {
          try {
            avatarData = JSON.parse(storedAvatar);
          } catch (e) {
            avatarData = { avatar: avatar[0] };
          }
        } else {
          avatarData = { avatar: avatar[0] };
        }

        let avatarDataEnemy;
        const storedAvatarEnemy = localStorage.getItem("Enemy/avatar");
        if (storedAvatarEnemy && storedAvatarEnemy !== "undefined") {
          try {
            avatarDataEnemy = JSON.parse(storedAvatarEnemy);
          } catch (e) {
            avatarDataEnemy = { enemy_avatar: enemy_avatar[0] };
          }
        } else {
          avatarDataEnemy = { enemy_avatar: enemy_avatar[0] };
        }

        document.querySelector(".character-image").src = avatarData.src;
        document.querySelector(".character-image").alt = avatarData.alt;
        document.querySelector(".character-image-enemy").src =
          avatarDataEnemy.src;
        document.querySelector(".character-image-enemy").alt =
          avatarDataEnemy.alt;

        const healthCharacter = avatarData.health;
        const healthEnemy = avatarDataEnemy.health;
        const count_attack = avatarDataEnemy.count_attack;

        // Расчет поражений
        document
          .getElementById("button-attack")
          .addEventListener("click", function () {
            const protectCharacter = document.querySelectorAll(
              'input[name="option"]:checked'
            );

            let hitEnemy;
            let damageCharacter = 0;
            healthCharacternew = healthCharacter;

            // textCharacter = characterName + " сделал " + characterNameEnemy;
            // textEnemy = characterNameEnemy + " ответил " + characterName;

            for (let i = 0; i < count_attack; i++) {
              hitEnemy = attack[Math.floor(Math.random() * attack.length)];
              const isProtected = [...protectCharacter].some(
                (item) => item.value === hitEnemy.id
              );
              if (!isProtected) {
                damageCharacter += hitEnemy.points;
                textCharacter += " " + attack.label;
              }
            }

            healthCharacternew = healthCharacternew - damageCharacter;
            // healthEnemynew = healthEnemynew - damageCharacter;

            localStorage.setItem("Damage/Character", damageCharacter);
            localStorage.setItem("Health/Character", healthCharacternew);

            // if (textCharacter) {
            //   document.getElementById("textCharacter").value = textCharacter;
            // }

            <!--Прогрессбар для персонажа-->

            let progressCharacter =
              document.getElementById("progress-character");
            progressCharacter.value = damageCharacter;
            progressCharacter.max = healthCharacternew;
            // let currentValue = 0;

            function character_progress() {}
          });
      });
    </script>
  </body>
</html>

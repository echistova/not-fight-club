<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <!-- <link type="script"  src="person.js" /> -->
    <title>Настройки персонажей</title>
  </head>
  <body>
    <header class="header-container">
      <div class="header-title" id="header-title">Ваш персонаж</div>
      <div class="navigation">
        <nav>
          <a href="fight.html"
            ><img src="./assets/png/fight.png" alt="В бой!"
          /></a>
          <a href="hero.html">
            <img
              src="./assets/png/hero.png"
              alt=" Ваш персонаж"
          /></a>
          <a href="character.html">
            <img
              src="./assets/png/settings.png"
              alt=" Изменить настройки персонажа"
          /></a>
        </nav>
      </div>
    </header>
    <main class="main-container">
      <div class="character-card">
        <div class="character-card-title">Ваш персонаж:</div>
        <div class="character-name">
          <input
            class="character-name-input"
            type="text"
            id="character-name"
            readonly
          />
        </div>
        <div class="character-edit">
          <img class="character-image" src="" alt="character-image">
          <img class="character-edit-image" src="./assets/png/edit.png" alt="edit-image" title="Выбрать персонаж"/>
        </div>
        <div class="button">
          <button type="button" class="button-submit" id="button-edit">
            Изменить
          </button>
          <button type="button" class="button-submit" id="button-submit">
            Сохранить
          </button>
        </div>
      </div>
  

    </main>
    <script>
      const avatar = [
          { id: 1, src: "./assets/img/fenek.jpg", alt: "Fenek" },
          { id: 2, src: "./assets/img/berkut.jpg", alt: "Berkut" },
          { id: 3, src: "./assets/img/cat.jpg", alt: "Cat" },
          { id: 4, src: "./assets/img/varan.jpg", alt: "Varan" },
          { id: 5, src: "./assets/img/peregusna.jpg", alt: "Peregusna" },
        ];

        document.addEventListener("DOMContentLoaded", () => {
        const name = localStorage.getItem("Player/name");
        const characterName = document.getElementById("character-name");
        const characterEditImage = document.querySelector('.character-edit-image');
        const submitButton = document.getElementById("button-submit");
        const editButton = document.getElementById("button-edit");        

        if (name) {
          document.getElementById("character-name").value = name;
        }

        let avatarData;
        const storedAvatar = localStorage.getItem("Player/avatar");
        if (storedAvatar && storedAvatar !== "undefined") {
            try {
                avatarData = JSON.parse(storedAvatar);
              } catch (e) {
                  avatarData = { avatar: avatar[0] }; 
              }
            } else {
                avatarData = { avatar: avatar[0] }; 
            }

        document.querySelector(".character-image").src = avatarData.src;
        document.querySelector(".character-image").alt = avatarData.alt;
       
        submitButton.addEventListener("click", () => {
          localStorage.setItem("Player/name", document.getElementById("character-name").value);
          characterEditImage.style.visibility = 'hidden';
          characterName.classList.remove("character-name-editable");
          submitButton.blur();
        });

        editButton.addEventListener("click", () => {
          if (characterName.hasAttribute("readonly")) {
            characterName.removeAttribute("readonly");
          }
          characterEditImage.style.visibility = 'visible';
          characterName.classList.add("character-name-editable");
          editButton.blur();
        });

        characterEditImage.addEventListener("click", () => {
            const currentId = avatarData.id;
            let newId;
            if (currentId < avatar.length) {
              newId = currentId;
            } else {
              newId = 0;
            }
            
          avatarData = avatar[newId];
          localStorage.setItem("Player/avatar", JSON.stringify(avatarData));
          document.querySelector(".character-image").src = avatarData.src;
          document.querySelector(".character-image").alt = avatarData.alt;
          characterEditImage.blur();
       });


      });
    </script>
  </body>
</html>
